rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // --- Agent Profiles for the Game ---
    // A user can only interact with their own agent document.
    match /agents/{userId} {
      // Allow reading, creating, and updating if the user is the owner of the document.
      allow read, create, update: if request.auth != null && request.auth.uid == userId;
      
      // Do not allow deletion of agent profiles from the client.
      allow delete: if false;
    }

    // --- Shared Map States ---
    // Anyone can create and read shared maps, but cannot change or delete them.
    match /sharedMaps/{mapId} {
      // Allow anyone to read a map state if they have the link (ID).
      allow read: if true;

      // Allow anyone (authenticated or not) to create a new shared map state.
      allow create: if true;

      // Explicitly deny updates and deletes from the client to protect shared data.
      allow update, delete: if false;
    }

    // --- Default Deny ---
    // Deny all other reads/writes to any other collection by default for security.
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
